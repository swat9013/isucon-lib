# [tmm1/stackprof: a sampling call-stack profiler for ruby 2.2+](https://github.com/tmm1/stackprof)
# ,[fusic/estackprof: Estackprof is a wrapper to make it easier to use Stackprof in your rack application.](https://github.com/fusic/estackprof)

# app.rb
require 'estackprof'

...
module xxxx
  class App < Sinatra::Base
    # profile
    use Estackprof::Middleware

    # logging
    enable :logging
    Dir.mkdir("log") unless File.exist?("log")
    access_log = File.new("log/access.log","a+")
    access_log.sync = true
    use Rack::CommonLogger, access_log

    app_log = File.new("log/application.log", "a+")
    app_log.sync = true
    app_logger = Logger.new(app_log)

    before do
      env["rack.logger"] = app_logger
    end
...
  error HttpError do
    ...
    logger.error(e)
    ...


# gemfile
gem 'estackprof'


bundle install


# command
estackprof top -p app.rb
estackprof list -f app.rb
